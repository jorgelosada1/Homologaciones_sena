{% extends "layout.html" %}
{% block content %}

<h2>üìä Aguachica ‚Äì Control Semanal</h2>

<style>
.contenedor {
    display: flex;
    gap: 30px;
    align-items: flex-start;
}

.col-izq {
    width: 60%;
}

.col-der {
    width: 40%;
    position: sticky;
    top: 20px;
    padding: 15px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: #fafafa;
}
</style>

<div class="contenedor">

    <!-- ================= IZQUIERDA ================= -->
    <div class="col-izq">

        <!-- FORMULARIO -->
        <form method="post" style="max-width:500px">
            <select name="ejecutivo" required>
                <option>Jorge</option>
                <option>Maria</option>
                <option>Ana</option>
            </select><br><br>

            <input type="number" name="llamadas" placeholder="Llamadas" required><br><br>
            <input type="number" name="inscritos" placeholder="Inscritos" required><br><br>
            <input type="number" name="pagos" placeholder="Pagos" required><br><br>

            <button>Guardar</button>
        </form>

        <hr>

        <!-- TABLA -->
        <h3>üìã Totales semana</h3>
        <table border="1" cellpadding="8" cellspacing="0" width="100%">
            <tr>
                <th>Ejecutivo</th>
                <th>Llamadas</th>
                <th>Inscritos</th>
                <th>Pagos</th>
            </tr>
            {% for t in totales.itertuples() %}
            <tr>
                <td>{{ t.ejecutivo }}</td>
                <td>{{ t.llamadas }}</td>
                <td>{{ t.inscritos }}</td>
                <td>{{ t.pagos }}</td>
            </tr>
            {% endfor %}
        </table>

        <hr>

        <!-- BORRAR -->
        <h3 style="color:#dc2626">üóëÔ∏è Borrar datos</h3>
        <form method="post" action="/aguachica/borrar">
            <input type="password" name="clave" placeholder="Contrase√±a" required><br><br>
            <button onclick="return confirm('Esto borrar√° todo')">Borrar todo</button>
        </form>

    </div>

    <!-- ================= DERECHA ================= -->
    <div class="col-der">

        <h3>üìà Progreso individual</h3>

        <form method="get">
            <select name="ejecutivo" onchange="this.form.submit()">
                {% for e in metas_ejecutivos.keys() %}
                <option value="{{ e }}" {% if e == ejecutivo_sel %}selected{% endif %}>
                    {{ e }}
                </option>
                {% endfor %}
            </select>
        </form>

        <br>

        <canvas id="graficaIndividual" height="220"></canvas>

    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
new Chart(document.getElementById("graficaIndividual"), {
    type: "bar",
    data: {
        labels: ["Llamadas", "Inscritos", "Pagos"],
        datasets: [
            {
                label: "Actual",
                data: [
                    {{ resumen_individual.llamadas }},
                    {{ resumen_individual.inscritos }},
                    {{ resumen_individual.pagos }}
                ],
                backgroundColor: "#2563eb"
            },
            {
                label: "Meta",
                data: [
                    {{ meta_individual.llamadas }},
                    {{ meta_individual.inscritos }},
                    {{ meta_individual.pagos }}
                ],
                backgroundColor: "#9ca3af"
            }
        ]
    },
    options: {
        responsive: true,
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>

{% endblock %}
